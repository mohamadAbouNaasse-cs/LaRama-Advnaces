# GraphQL API (NestJS Admin, port 4001)

- Endpoint: `http://localhost:4001/graphql`
- Auth: header `x-admin-key: <ADMIN_KEY>` (must match `.env` in `laRama_backend_nest` and `VITE_ADMIN_KEY` in frontend)
- Schema file: `laRama_backend_nest/src/schema.gql` (auto-generated by `@nestjs/graphql`)

## Entities
`ProductEntity` maps to the `products` table (UUID id, name, description?, price, imageUrl?, category?, stockQuantity, isActive, createdAt, updatedAt).

## Operations

### Queries
```graphql
query ListProducts {
  products {
    id
    name
    price
    category
    stockQuantity
    isActive
    updatedAt
  }
}

query OneProduct($id: ID!) {
  product(id: $id) {
    id
    name
    description
    price
    imageUrl
    category
    stockQuantity
  }
}
```

### Mutations
```graphql
mutation Create($input: CreateProductInput!) {
  createProduct(input: $input) {
    id
    name
    price
    stockQuantity
    isActive
  }
}

mutation Update($input: UpdateProductInput!) {
  updateProduct(input: $input) {
    id
    name
    price
    stockQuantity
    isActive
  }
}

mutation Remove($id: ID!) {
  removeProduct(id: $id) {
    id
    name
  }
}
```

### Using Apollo Client (frontend)
Configuration: `src/api/client.js` attaches `x-admin-key` from `VITE_ADMIN_KEY` and targets `VITE_GRAPHQL_URL`.

Example call in Redux thunk (`productsSlice`):
```js
export const loadProducts = createAsyncThunk('products/load', async () => {
  const products = await productsAPI.fetchProducts();
  return products;
});
```

## Testing the endpoint
```bash
curl -X POST http://localhost:4001/graphql \
  -H 'Content-Type: application/json' \
  -H 'x-admin-key: YOUR_KEY' \
  -d '{"query":"{ products { id name price } }"}'
```
